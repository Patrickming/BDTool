# Binance Alpha Order Exporter

一个 Chrome 扩展，用于导出币安 Alpha 交易订单历史，并提供详细的交易统计分析和积分计算功能。

## 功能特性

### 1. 订单数据提取

- 从币安 Alpha 交易页面直接提取订单数据
- 支持提取完整的订单信息（创建时间、代币、类型、方向、价格、成交额等）
- 自动去重，避免重复提取

### 2. 智能积分计算系统

- **15 天滚动窗口**：自动计算最近 15 天的有效积分
- **14:00 北京时间分界点**：
  - 每日 14:00 前的交易算作前一天
  - 14:00 后的交易算作当天
- **加权积分计算**：
  - 自动从币安 API 获取币种倍数（1x/2x/4x）
  - 支持手动设置未知币种的倍数
  - 实时计算加权买入金额和积分

### 3. 积分规则

根据每日加权买入金额计算积分：

- \> 128 USDT = 7 分
- \> 64 USDT = 6 分
- \> 32 USDT = 5 分
- \> 16 USDT = 4 分
- \> 8 USDT = 3 分
- \> 4 USDT = 2 分
- \> 2 USDT = 1 分

### 4. 统计分析功能

- 显示总买入/卖出金额
- 显示盈亏情况
- 每日交易明细（原始金额 vs 加权金额）
- 有效积分窗口标注
- 未知倍数币种警告

### 5. 数据导出

- **CSV 导出**：导出原始订单数据
- **Excel 导出（订单）**：导出格式化的订单历史
- **Excel 导出（统计）**：导出包含 3 个工作表的详细统计：
  - 统计分析（全部历史数据）
  - 有效积分窗口（最近 15 天）
  - 币种明细（每个币种的详细交易信息）

## 安装方法

### 方式一：开发者模式安装（推荐）

1. 克隆或下载本项目到本地

```bash
git clone <repository-url>
cd BinanceOrderExporter
```

2. 打开 Chrome 浏览器，进入扩展管理页面：

   - 地址栏输入：`chrome://extensions/`
   - 或点击：菜单 → 更多工具 → 扩展程序

3. 开启右上角的"开发者模式"

4. 点击"加载已解压的扩展程序"

5. 选择本项目的文件夹

6. 扩展安装成功！

### 方式二：打包安装

1. 在扩展管理页面点击"打包扩展程序"
2. 选择本项目文件夹
3. 生成 .crx 文件
4. 拖拽 .crx 文件到扩展管理页面安装

## 使用方法

### 1. 提取订单数据

1. 访问币安 Alpha 交易页面

2. 进入"历史委托"标签页

3. 点击浏览器工具栏的扩展图标

4. 点击"提取订单数据"按钮

5. 等待提取完成（状态显示"提取成功"）

### 2. 查看统计

1. 提取数据后，点击"查看统计"按钮

2. 查看详细的交易统计信息：

   - 当前北京时间
   - 有效积分窗口（最近 15 天）
   - 总买入/卖出金额
   - 盈亏情况
   - 每日积分明细

3. 如果出现未知倍数币种警告：
   - 点击"点击修复"按钮
   - 为每个未知币种选择倍数（1x/2x/4x）
   - 点击"保存"
   - 重新查看统计

### 3. 导出数据

#### 导出订单历史

- 点击"导出 CSV"：导出原始订单数据（CSV 格式）
- 点击"导出 Excel"：导出格式化的订单历史（XLSX 格式）

#### 导出统计报告

1. 点击"导出统计 Excel"
2. 生成包含 3 个工作表的完整统计报告：
   - **统计分析（全部）**：全部历史数据的统计汇总
   - **有效积分窗口**：最近 15 天的有效积分详情
   - **币种明细**：每个币种的详细交易信息

### 4. 清空数据

- 点击"清空数据"按钮可以清除所有已提取的订单数据
- 清空后需要重新提取

## 技术实现

### 架构说明

- **Manifest V3**：使用最新的 Chrome 扩展 API
- **DOM 提取**：直接从页面 DOM 提取订单数据
- **Chrome Storage API**：本地存储订单数据和币种倍数
- **SheetJS (XLSX)**：生成真正的 Excel 文件

### 核心文件

```
BinanceOrderExporter/
├── manifest.json                 # 扩展配置文件
├── popup.html                    # 弹窗界面
├── popup.js                      # 主要逻辑
├── coin-multiplier-manager.js    # 币种倍数管理
├── content-dom-extractor.js      # DOM数据提取
├── background.js                 # 后台服务
├── libs/
│   └── xlsx.full.min.js         # Excel处理库
└── icons/                        # 图标资源
```

### 关键技术点

#### 1. 时间处理

所有时间均按北京时间（UTC+8）处理：

```javascript
function getBeijingTime() {
  const now = new Date();
  const utcTime = now.getTime() + now.getTimezoneOffset() * 60000;
  return new Date(utcTime + 3600000 * 8); // UTC+8
}
```

#### 2. 有效交易日计算

```javascript
function getEffectiveDate(orderTimeStr) {
    // 解析订单时间
    const orderTime = new Date(...);

    // 如果时间 < 14:00，算作前一天
    if (orderTime.getHours() < 14) {
        orderTime.setDate(orderTime.getDate() - 1);
    }

    return formatDate(orderTime);
}
```

#### 3. 15 天滚动窗口

```javascript
function getValid15DayWindow() {
  const bjNow = getBeijingTime();

  // 计算有效结束日期
  let effectiveEndDate = new Date(bjNow);
  effectiveEndDate.setDate(effectiveEndDate.getDate() - 1); // 昨天

  if (bjNow.getHours() < 14) {
    effectiveEndDate.setDate(effectiveEndDate.getDate() - 1); // 前天
  }

  // 开始日期：结束日期往前推14天（总共15天）
  const effectiveStartDate = new Date(effectiveEndDate);
  effectiveStartDate.setDate(effectiveStartDate.getDate() - 14);

  return { startDate, endDate };
}
```

#### 4. 币种倍数获取

自动从币安 API 获取币种倍数：

```
API: https://www.binance.com/bapi/defi/v1/public/wallet-direct/buw/wallet/cex/alpha/all/token/list
```

## 数据安全

- ✅ 所有数据存储在本地（Chrome Storage）
- ✅ 不上传任何数据到外部服务器
- ✅ 只访问币安官方 API 获取币种信息
- ✅ 开源代码，可自行审查

## 常见问题

### Q: 为什么提取失败？

A: 请确保：

1. 在币安网站的"历史委托"标签页
2. 页面已完全加载
3. 订单列表中有数据

### Q: 为什么有些币种显示"⚠️ 未知"？

A: 这些币种的倍数信息暂未从 API 获取到，可以手动设置：

1. 点击"点击修复"按钮
2. 选择对应的倍数（1x/2x/4x）
3. 保存后重新查看统计

### Q: 积分计算规则是什么？

A:

1. 每日的加权买入金额 = Σ(币种买入金额 × 币种倍数)
2. 根据加权买入金额计算积分（>128=7 分，>64=6 分，依此类推）
3. 只统计最近 15 天（按 14:00 分界）的有效积分

### Q: 为什么 14:00 前的交易算前一天？

A: 这是币安 Alpha 积分系统的规则，每天 14:00 北京时间是分界点。

### Q: 数据存储在哪里？

A: 所有数据存储在浏览器的本地存储中（Chrome Storage），不会上传到任何服务器。

### Q: 如何更新币种倍数？

A: 币种倍数每小时自动从币安 API 更新一次，也可以手动设置。

## 更新日志

### v2.0.0 (2025-10-22)

- ✨ 新增币种倍数管理系统
  - 自动从币安 API 获取币种倍数（1x/2x/4x）
  - 支持手动设置未知币种倍数
  - 每小时自动更新倍数数据
- ✨ 新增加权积分计算
  - 根据币种倍数计算加权买入金额
  - 实时显示原始金额 vs 加权金额
- ✨ 新增 3 个工作表的统计 Excel 导出
  - Sheet 1: 统计分析（全部历史数据）
  - Sheet 2: 有效积分窗口（最近 15 天）
  - Sheet 3: 币种明细（每个币种的详细交易信息）
- 🐛 修复盈亏计算错误（改为 卖出-买入）
- 🐛 修复 15 天窗口边界计算问题
- 🐛 修复有效买入显示错误（显示总加权而非窗口加权）
- 🐛 修复状态文本显示（"过期"改为"无效"）
- 🐛 添加调试日志功能，便于排查数据问题
- 💄 优化统计界面显示
  - 未知倍数币种标红显示
  - 有效/无效交易日清晰标注
  - 独立滚动的表格容器

### v1.3.0

- ✨ 新增 15 天滚动窗口积分计算
- ✨ 新增 14:00 北京时间分界点逻辑
- 💄 优化统计展示 UI

### v1.2.0

- ✨ 新增统计分析功能
- ✨ 新增 Excel 导出功能

### v1.1.0

- 🔨 移除网络监听方案
- 🔨 简化为单按钮操作

### v1.0.0

- 🎉 初始版本
- ✨ 基础订单提取功能
- ✨ CSV 导出功能

## 开发者信息

### 开发环境要求

- Chrome 浏览器 88+
- Node.js（可选，用于开发工具）

### 调试方法

1. 在扩展管理页面，点击"检查视图"→"popup.html"
2. 打开开发者工具查看控制台日志
3. 查看 `[订单分类]` 和 `=== 每日汇总 ===` 日志

## 许可证

MIT License

## 免责声明

本扩展仅供个人学习和使用，不对因使用本扩展导致的任何损失负责。请遵守币安的使用条款和相关法律法规。

---

**注意**：本扩展不是币安官方产品，使用风险自负。
