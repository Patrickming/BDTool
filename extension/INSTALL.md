# 安装和测试指南

## 🚀 快速开始

### 步骤 1: 准备图标（可选）

插件需要 3 个尺寸的图标文件。如果没有图标，插件仍然可以工作，只是会显示默认图标。

**生成图标（使用在线工具）：**
1. 访问 https://www.favicon-generator.org/
2. 上传一个 logo 图片或使用文字"K"
3. 下载生成的图标
4. 重命名为 `icon16.png`, `icon48.png`, `icon128.png`
5. 放置到 `extension/icons/` 目录

**或者暂时跳过此步骤，使用默认图标。**

---

### 步骤 2: 加载插件到 Chrome

1. **打开 Chrome 扩展程序页面**
   ```
   在地址栏输入: chrome://extensions/
   ```

2. **启用开发者模式**
   - 点击页面右上角的"开发者模式"开关

3. **加载插件**
   - 点击"加载已解压的扩展程序"按钮
   - 选择 `/home/pdm/DEV/projects/BDTool/extension` 目录
   - 点击"选择文件夹"

4. **验证安装**
   - 插件应该出现在扩展程序列表中
   - 名称：`KOL BD Tool - Twitter Assistant`
   - 版本：`1.0.0`

5. **固定到工具栏**
   - 点击 Chrome 工具栏的拼图图标（扩展程序）
   - 找到"KOL BD Tool"
   - 点击图钉图标，将其固定显示

---

### 步骤 3: 配置认证 Token

**获取 Token:**

1. 打开 KOL BD Tool 前端：http://localhost:5173
2. 登录您的账号
3. 打开浏览器开发者工具（按 F12）
4. 切换到 `Console` 标签
5. 输入并执行：
   ```javascript
   localStorage.getItem('token')
   ```
6. 复制输出的 Token（一长串字符串）

**设置 Token:**

1. 点击 Chrome 工具栏的插件图标
2. 在弹出窗口中找到"认证 Token"输入框
3. 粘贴刚才复制的 Token
4. 点击"保存 Token"按钮
5. 看到"✅ 已登录"表示成功

---

### 步骤 4: 测试插件功能

#### 测试 1: 捕获单个 KOL

1. 访问任意 Twitter 用户主页
   - 例如：https://twitter.com/elonmusk
   - 或：https://x.com/jack

2. 等待页面完全加载（2-3秒）

3. 查找"📸 添加到系统"按钮
   - 应该出现在用户资料卡片的操作栏中
   - 位置：通常在"关注"按钮旁边

4. 点击"📸 添加到系统"按钮
   - 按钮会变为"处理中..."
   - 成功后显示"✅ 已添加"
   - 失败会显示"❌ 失败"并弹出错误信息

5. 验证数据
   - 打开 KOL BD Tool 系统：http://localhost:5173/kols
   - 检查刚才添加的用户是否出现在列表中
   - 验证数据是否正确（用户名、粉丝数等）

#### 测试 2: 使用插件弹窗捕获

1. 在 Twitter 用户主页，点击插件图标

2. 查看页面检测
   - 应该显示"✅ Twitter 个人主页"
   - "📸 捕获当前用户"按钮应该是可点击的

3. 点击"📸 捕获当前用户"

4. 等待操作完成
   - 成功会显示绿色提示消息
   - 失败会显示红色错误消息

#### 测试 3: 批量捕获（高级功能）

1. 访问关注列表
   - 例如：https://twitter.com/elonmusk/following

2. 向下滚动加载更多用户
   - 至少滚动到可以看到 10-20 个用户

3. 点击插件图标

4. 查看页面检测
   - 应该显示"✅ 关注/粉丝列表"
   - "📦 批量捕获"按钮应该是可点击的

5. 点击"📦 批量捕获"

6. 等待批量导入完成
   - 会显示成功导入的数量
   - 例如："成功捕获 15 个用户"

7. 验证数据
   - 打开 KOL BD Tool 系统
   - 检查新增的用户

---

## 🐛 故障排除

### 问题 1: 插件加载失败

**症状：**
- 点击"加载已解压的扩展程序"后报错
- 或插件出现在列表但显示错误

**解决方法：**
1. 检查是否选择了正确的目录（`extension/` 目录）
2. 确保目录中包含 `manifest.json` 文件
3. 检查 manifest.json 语法是否正确
4. 查看错误详情并修复对应文件

### 问题 2: Token 保存失败

**症状：**
- 点击"保存 Token"后显示"Token 无效"
- 或一直显示"⚠️ 请先登录系统"

**解决方法：**
1. 确保后端服务正在运行（http://localhost:3000）
2. 确保 Token 是有效的（未过期）
3. 重新获取 Token 并尝试
4. 检查浏览器控制台的错误信息

### 问题 3: "添加到系统"按钮不出现

**症状：**
- 在 Twitter 个人主页看不到按钮

**解决方法：**
1. 等待 2-3 秒让插件注入完成
2. 刷新页面（Ctrl+R 或 Cmd+R）
3. 确保 URL 格式正确（例如：twitter.com/username）
4. 打开开发者工具查看 Console 是否有错误

### 问题 4: CORS 错误

**症状：**
- 控制台显示 CORS 错误
- 无法连接到后端 API

**解决方法：**
1. 检查后端 `.env` 文件的 `CORS_ORIGIN` 配置
2. 确保包含：`http://localhost:5173`
3. 重启后端服务
4. 清除浏览器缓存

### 问题 5: 捕获失败

**症状：**
- 点击按钮后显示"❌ 失败"
- 或提示错误信息

**可能原因和解决方法：**

1. **Token 过期**
   - 重新获取 Token 并保存

2. **网络问题**
   - 检查后端服务是否运行
   - 检查网络连接

3. **数据提取失败**
   - Twitter 页面结构可能已更改
   - 查看控制台错误信息
   - 等待页面完全加载后重试

4. **已存在重复**
   - 该用户可能已经在系统中
   - 检查 KOL 列表

---

## 🔍 调试技巧

### 查看插件日志

1. 打开 `chrome://extensions/`
2. 找到"KOL BD Tool"
3. 点击"检查视图" → `service worker` 或 `popup.html`
4. 在 Console 中查看日志

### 查看 Content Script 日志

1. 在 Twitter 页面按 F12
2. 切换到 Console 标签
3. 查找 `[KOL BD Tool]` 开头的日志

### 测试 API 连接

在浏览器 Console 中执行：

```javascript
// 测试认证
fetch('http://localhost:3000/api/v1/kols?limit=1', {
  headers: {
    'Authorization': 'Bearer YOUR_TOKEN_HERE'
  }
}).then(r => r.json()).then(console.log)
```

---

## ✅ 验收清单

完成以下所有测试，确保插件正常工作：

- [ ] 插件成功加载到 Chrome
- [ ] Token 保存成功
- [ ] 在 Twitter 个人主页能看到"添加到系统"按钮
- [ ] 点击按钮能成功捕获用户资料
- [ ] 捕获的数据正确保存到系统
- [ ] 插件弹窗能正确检测页面类型
- [ ] 通过弹窗能成功捕获用户
- [ ] 批量捕获功能正常工作
- [ ] 今日统计数字正常更新

---

## 📝 下一步

插件开发完成后：

1. **优化和改进**
   - 添加更多错误处理
   - 优化数据提取逻辑
   - 改进 UI 设计

2. **打包发布**
   - 准备正式图标
   - 编写详细文档
   - 打包为 .crx 文件（可选）

3. **团队部署**
   - 分享给团队成员
   - 收集反馈
   - 持续改进

---

**需要帮助？**
查看 extension/README.md 或联系开发团队。

*最后更新：2025-11-08*
